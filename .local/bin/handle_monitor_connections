#!/bin/sh

handle_event() {
    event_name="${1%%>>*}"
    data="${1#*>>}"

    case "$event_name" in
        monitoraddedv2)
            monitor_id="${data%%,*}"
            remaining="${data#*,}"
            monitor_name="${remaining%%,*}"
            monitor_desc="${remaining#*,}"

            case "$monitor_name" in
                HDMI-*)
                    return
                    ;;
            esac

            case "$monitor_desc" in
                *StudioDisplay*)
                    asdbctl set 55
                    ;;
            esac

            case "$monitor_name" in
                DP-*)
                    hyprctl workspaces -j | jq -r '.[].id' | while read -r ws_id; do
                        hyprctl dispatch moveworkspacetomonitor "$ws_id" "$monitor_name"
                    done
                    
                    brightnessctl set 0
                    ;;
            esac
            ;;

        monitorremovedv2)
            brightnessctl set 50
            ;;
    esac
}

SOCKET="$XDG_RUNTIME_DIR/hypr/$HYPRLAND_INSTANCE_SIGNATURE/.socket2.sock"

if [ -S "$SOCKET" ]; then
    socat -U - UNIX-CONNECT:"$SOCKET" | while read -r line; do
        handle_event "$line"
    done
else
    echo "Error: Hyprland socket2 not found at $SOCKET"
    exit 1
fi
