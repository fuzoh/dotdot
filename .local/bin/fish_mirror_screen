#!/usr/bin/env fish

function disable_mirroring

    notifiy-send Mirroring "terminating mirroring" -t 1000
    hyprctl keyword monitor eDP-1, disable
    sleep .5
    hyprctl reload
    sleep 1
    killall waybar && waybar

end

# Check if the main monitor (laptop one) is currently mirrored
set is_mirror (hyprctl monitors all -j | jq -r '.[0].mirrorOf')

# Get all other displays
set available_displays (hyprctl monitors all -j | jq -r '.[1:] | .[] | "\(.name) - \(.availableModes[0])"')

# If there is available displays
if test -n "$available_displays"

    # TODO: ask user wich monitor to mirror, currently only HDMI one
    # There is available display for mirroring
    if test "$is_mirror" = none
        notify-send Mirroring "starting mirroring" -t 1000
        # Update script to use best resolution available for monitor and predefined scaling (<1920 x1, >1920 x2, >2880 x3)
        hyprctl keyword monitor HDMI-A-1,3840x2160,0x0,3
        hyprctl keyword monitor eDP-1, preferred, auto, 1, mirror, HDMI-A-1
    else
        disable_mirroring
    end

else
    # No available displays
    notify-send Mirroring "no available displays for mirroring" -t 1000
    disable_mirroring

end
